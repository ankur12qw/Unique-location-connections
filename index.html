<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Router Location Connections</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    #output { white-space: pre-line; }
  </style>
</head>
<body>
  <h1>Router Location Connections</h1>
  <button id="loadBtn">Load Connections</button>
  <div id="output"></div>

  <script>
    const APIURL = "https://my-json-server.typicode.com/marcuzh/router_location_test_api/db";

    async function loadConnections() {
      const outputEl = document.getElementById('output');
      outputEl.textContent = "Loading...";

      try {
        const response = await fetch(APIURL);
        if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
        const data = await response.json();

        // Mapping router ID to its location ID

        const routerToLocation = {};
        data.routers.forEach(router => {
          routerToLocation[router.id] = router.location_id;
        });
        
        // Mapping location ID to its name
        
        const locationIdToName = {};
        data.locations.forEach(location => {
          locationIdToName[location.id] = location.name;
        });

       // Creating a Set which is unique location-level connections
        
        const locationConnections = new Set();

        data.routers.forEach(router => {
          const sourceRouterId = router.id;
          const sourceLocationId = router.location_id;
          const sourceLocationName = locationIdToName[sourceLocationId];

          router.router_links.forEach(linkedRouterId => {
            const targetLocationId = routerToLocation[linkedRouterId];
            const targetLocationName = locationIdToName[targetLocationId];

            if (sourceLocationId !== targetLocationId) {
              
              // Creating a sorted pair to avoid duplicates like A <-> B and B <-> A
        
              const pair = [sourceLocationName, targetLocationName].sort();
              locationConnections.add(pair.join(' <-> '));
            }
          });
        });


        if (locationConnections.size === 0) {
          outputEl.textContent = "No cross-location connection data found.";
          return;
        }

        outputEl.textContent = [...locationConnections].join('\n');

      } catch (error) {
        outputEl.textContent = "Error loading data: " + error.message;
      }
    }

    document.getElementById('loadBtn').addEventListener('click', loadConnections);
  </script>
</body>
</html>
